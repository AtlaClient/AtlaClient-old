	Клиент v0.9.1.11 для Атлантиса v4.0.4

	Основные возможности:
- хранение информации обо всех загруженных ходах,
- виртуальная отработка ходов,
- поддержка нескольких игр и нескольких фракций в одной игре.

	Общая информация.
   Игра создается командой меню "New game" (в диалоге
надо ввести имя директории игры и поставить галку на
"Create new database").
   Список всех активных игр содержится в файле Atlaclient.ini.
   При создании новой игры создается директория с ее именем
и поддиректориями orders и reports.
   Для каждой игры создается своя база данных о предметах, умениях
и т.д., которая хранится в текстовых файлах в директории игры.
Их можно редактировать во встроенном редакторе или напрямую.
   Отчеты загружаются командой "Load report(s)", которая поддерживает
загрузку нескольких отчетов (файлы отчетов загружаются в алфавитном
порядк). При успешной загрузке последнего отчета выдается событие
"Report processed". Клиент также понимает отчеты, состоящие только
из описания регионов, при этом они могут загружаться в нулевой турн.
   В каждой игре может присутствовать несколько "локальных" фракций,
т.е. фракций, находящихся под контролем игрока, они создаются автоматически
при загрузке отчета для данной фракции. В клиенте пока отсутствует интерфейс
для работы с фракциями (создание, удаление и определение отношения т.д.).
   Приказы загружаются командой "Load order(s)". Первой строкой приказа
должна быть #atlantis ... Внимание: в приказах нет информации о номере хода,
поэтому они грузятся в текущий ход.
   Приказы записываются командой "Save orders" в поддиректорию orders игры
сразу для всех локальных фракций.
   Внимание: в отличие от других клиентов и картограферов в данном не
два уровня, а три (нексус, поверхность и подземелье) и изначально
карта показывает нексус.
 
	Интерфейс.
   Четыре окна: Карта, Дерево, Информация и События.
Так же имеется панель инструментов с:
- кнопкой показа окна событий, 
- кнопкой просчета хода для всех регионов,
- кнопкой выполнения автоприказов,
- полем поиска юниты (номер новой юниты - отрицательное число),
- полем ввода номера хода (для быстрого перехода).
- кнопками смены хода (предыдущий/следующий).
- кнопками выбора режима карты (карта/продукция/фильтр).
- кнопками смены уровня карты (нексус/поверхность/подземелье).


  В окне карты, естественно, изображается известная карта.
Для каждого региона в режиме карты показывается:
- присутствие локальных фракций (показывается галкой) и
  собирание в этом регионе налогов (галка превращается в треугольник)
- тип и название города (кружком различной формы)
- наличие зданий (башня), кораблей, туннелей (shaft), а также
логов монстров
В режиме продукции показывается список предметов, которые можно
производить в данном регионе, этот режим настраивается пунктом
меню "View\Products mode settings".
В режиме фильтров показываются результаты заданных пользователем
выражений в виде шести треугольников. Подробнее смотри в разделе
"Фильтр карты".
При клике левой кнопкой происходит выбор региона,
при клике правой - центрирование карты.

  В Дереве показывается:
- список локальных фракций, с произошедшими ошибками, битвами, событиями
и приказами, относящимися ко всей фракции (пока не реализовано),
- текущий регион со всеми объектами и юнитами.
При клике левой кнопкой происходит показ информации о выделенном элементе,
при правом клике - появляется контекстное меню.
  Дерево является сортированным: сначала показываются безымянные новые юниты,
затем юниты локальных фракций, потом остальные, и в конце - строения.

  В окне Информации показывается информация о текущем элементе.
При двойном клике происходит переход на выбранный элемент
(при двойном клике на первой строке обычно происходит переход на
базовый элемент), при правом - появляется контекстное меню.
- для фракции: информация о ней (+ количество таксованных регионов
на следующий ход (Внимание: верно только после запуска хода для всех
регионов)). Можно перейти на ошибки, битвы и события.
- для ошибок, битв и событий: текст из отчета.
  Имеется возможность удалить как отдельную строчку, так и весь список.
- для региона: информация о регионе (непустые строения предваряются
двумя плюсами, юниты с неизвестной фракцией - двумя минусами).
  Для каждого региона можно выставить максимальный уровень налогов,
количество рабочих, заработок при Entertainment'e (для просчета),
а также перейти в последний ход со свежей информацией о нем.
- для здания: информация и список юнитов, туннели можно связать между собой.
- для юнита: предметы, умения, боевое заклинание, список возможных умений
для обучения магии, описание, приказы, состояние юниты в конце хода.

	Команды меню.
Analyze/Advanced products - проверяет регионы на наличие "продвинутых"
предметов. Например, в регион зашел шахтер 3-го уровня (он может
добывать митрил) и ничего не нашел, клиент добавляет в регион,
что митрила в нем точно нет, что показывается нулевым производством.
На карте в режиме продукции отсуствие предмета показывается перечеркнутым
названием.

Settings/Options - настройки клиента.
  Закладка Colors позволяет задать цвета карты.
  Закладка Options:
 при выключенном Show closed Events window закрытое окно сообщений
не будет показываться при появлении нового сообщения,
 при выключенном Run Orders on change не будут выполнятся приказы
при смене юниты и региона.
 Town name limit позволяет обрезать имя города на карте.
  Закладка Events позволяет отключать показ некоторых сообщений.

	Приказы.
   Почти у всех приказов есть два флага:
- повторяющийся (repeating) - аналог '@' перед приказом
- закомментированный (commented) - аналог ';' после '@'

   В клиенте есть 5 новых типов приказов:
- local description - локальное описание, используется как имя юнита
для юнитов с именем "Unit", может быть преобразовано в комментарий.
- commentary - комментарий, может быть преобразован в локальное описание
и приказ пользователя.
   Внимание: при загрузке приказа игнорируются неповторяющиеся
закомментированные приказы, поэтому неповторяющиеся комментарии
не считываются.
- custom order -  приказ пользователя, приказ, не обрабатываемый
клиентом, клиент распознает Месячные приказы, может быть преобразован
в комментарий и обрабатываемый приказ.
- автоприказы (начинаются с "@;!"), обрабатываются только клиентом.
Пример: приказ autoGIVE.
- приказы клиента, служат для упрощения отдачи приказов.
Пример: приказ Receive.

   Приказы можно давать не только своим юнитам, но и чужим,
при этом они используются только для виртуального выполнения.
Приказы STUDY и FORGET для чужих юнит срабатывают сразу.
Повторяющиеся приказы чужим юнитам и их умения автоматически
переносятся в следующий турн.

   Клиент понимает следующие приказы:
- FORM
   Особенностью реализации данного приказа является то, что юнит 
всегда создается последним юнитом в данном объекте, поэтому флаги
нового юнита могут быть изменены. Во избежание этого при создании
юнита в клиенте (команда "Form new unit") добавляются команды
установки всех флагов. Также в регионе не может быть нескольких
новых юнитов с одинаковыми номерами, даже принадлежащих разным
фракциям.
   Новый юнит можно удалить командой "Delete new unit".
- AUTOTAX, AVOID, BEHIND, GUARD, HOLD, NOAID
   При чтении из приказов понимаются только значения флагов 1/0
и true/false.
- REVEAL, CONSUME
- LEAVE, ENTER
- MOVE, SAIL, ADVANCE
  Приказ SAIL обрабатывается частично (не учитывается изменение положения
юнит командами LEAVE/ENTER).
- DESTROY, PILLAGE
   Приказы понимаются, но не обрабатываются.
- ENTERTAIN, WORK, COMBAT, FORGET, GIVE, SELL, BUY, PRODUCE, CLAIM
- BUILD
   Проверяется умение строителя и наличие материала, изменяется
информация для здания.
- STUDY, TEACH, FORGET
   Клиент проверяет возможность обучения данному умению.
- TAX
   Пока считается, что таксовать могут все юниты умеющие "COMBAT"
или имеющие оружие, причем умение использовать оружие пока не 
проверяется. Также проверяется запрещение таксовать охраной.
   Особенность: при AUTOTAX 1 приказ неповторяющийся TAX показывается
в клиенте, но не записывается.

   Автоприказы:
- autoGIVE: Позволяет передавать какому-либо юниту или все предметы
определенного типа, или определенное число предметов, или все предметы,
кроме какого-либо числа. Целевой юнит задается или началом имени, или
подстрокой имени, или и тем и другим одновременно. Под именем в данном
случае понимается имя_юниты+локальное_описание+(номер).
- NOP: позволяет убрать сообщение о том, что юнит ничего не делает.

   Приказы клиента:
- RECEIVE
    Позволяет взять предмет у другого юнита. Реализуется
отдачей приказа give этому юниту.


        Фильтр карты.
   Режим настраивается пунктом меню "View\Wedge mode settings".
Можно задать до 6 выражений, логический результат которых
будет показан в регионе треугольником соответствующего цвета.
   В выражениях используются следующие типы данных:
- int - целое число
- ints - набор целых чисел
- string - строка, пишется в двойных кавычках.
   Определены следующие операции:
- == - равенство
- != - неравенство
- > и < - больше и меньше.
- && - логическое И
- || - логическое ИЛИ
- ! - логическое НЕ
- ( и ) - скобки для изменения приоритета операций.
- { и } - задание набора чисел, числа перечисляются через запятую.
- - - унарный минус
   Набор чисел считается равным числу, когда это число содержится в нем.
   Набор чисел равен другому набору, когда хотя бы одно число из
второго набора содержится в первом наборе.
   Набор чисел больше другого, когда все числа второго набора содержатся в нем.
   Строки можно сравнивать только на равенство.

   Приоритет операций:
- !, -, (), {}
- ==, !=, >, <
- &&
- ||

   Определены следующие переменные:
- presentfaction - набор номеров фракций, присутствующих в этом регионе.
   Юниты с неопределенной фракцией приписываются фракции с номером 0.
- guardfaction - набор номеров фракций, стоящих на охране в регионе.
- localfaction - набор номеров локальных фракций.
- localobservation - число, соответствующее уровню observation локальных
юнитов в этом регионе.
- regioninfoage - возраст информации о регионе.
- gatenumber - номер ворот (0 - если нет).
- consumetype - 0 - нет юнит с consume, 1 - есть юниты с consume unit,
2 - есть юниты с consume faction, 3 - есть юниты с consume unit и с
consume faction.


   Определены следующие функции:
- int productamount(string) - возвращает возможное количество производимой
продукции заданного типа в этом регионе.
- int saledamount(string) - возвращает макс. количество продаваемых предметов
- int saledprice(string) - возвращает цену продаваемых предметов
- int wantedamount(string) - возвращает макс. количество покупаемых предметов
- int wantedprice(string) - возвращает цену покупаемых предметов
- int presentitem(string) - возвращает количество предметов данного типа
в регионе.
- int presentlocalitem(string) - возвращает количество предметов данного типа
в регионе, находящихся у локальных юнитов.
- int presentnonlocalitem(string) - возвращает количество предметов данного типа
в регионе, находящихся у нелокальных юнитов.

        Примечания.
   Особенность иллюзорных предметов: первая буква сокращения переводится
на русский язык.

   Желаю успехов в мире Атлантиса.

   Евгений Пашкин (eap&newmail.ru)
   AKA EAP (115) в Game2 на atlantis.mtu.ru

ЗЫ. Рисунки в директории images загружаются клиентом и их можно
редактировать, не меняя их размер.

ЗЗЫ. Описание файлов настроек.
        items.txt - предметы
Каждая строка имеет следующий формат:
"имя предмета","множ.число","сокращение"[,CANTGIVE]
[,"умение для производства",уровень[,"требуемый материал",кол-во]]
,вес{,тип_предмета},WALK,RIDE,FLY,SWIM,
[,HELPPROD:"предмет, помогающего производству данного"]
  где тип_предмета=(NORMAL,ADVANCED,TRADE,MAN,MONSTER,MAGIC,
                 WEAPON,ARMOR,MOUNT,BATTLE,FOOD)

        keyphrases.txt
В этом файле содержатся ключевыц строки, по которым клиент определяет
наличие информации в отчете. Нельзя менять порядок строк и их количество.

        objtype.txt - типы зданий
Каждая строка имеет следующий формат:
"имя здания",защита,вместимость
[,"предмет для постройки",кол-во[,"умение для постройки",уровень]]
,моряки,можно_ли_входить[,"предмет,производству которого помогает"]
[,"ROAD":{список направлений через запятую}]
 если для строительства можно использовать лес или камень, то
предмет для постройки - "WOOD_OR_STONE".

        skillrep.txt - описания умений
Каждая строка имеет следующий формат:
"умение",уровень,"описание"

        skills.txt - умения
Каждая строка имеет следующий формат:
"умение","сокращение".цена_учебы{,тип_умения}
{,"требуемое умение",уровень}
 где тип_умения=(MAGIC,COMBAT,CAST,FOUNDATION),
требуемых умений может быть не больше трех.

        terrain.txt - типы местности
Каждая строка имеет следующий формат:
"местность",затраты_при_движении[,RIDING][,FLYING]
{,"добываемый продвинутый предмет"}:цвет_на_карте

        weather.txt - типы погоды
Каждая строка имеет следующий формат:
"погода",множитель_для_затрат_при_движении,"описание в текущем месяце"
,"описание в следующем месяце"

        weatherregion.txt - погодные регионы
Каждая строка имеет следующий формат:
"имя погодного региона", уровень, x1,y1,x2,y2
[ {,"тип ненормальной погоды", список номеров месяцев (январь - 0) }]
 где {} - означает возможный повтор,
 x1,y1,x2,y2 - прямоугольник, в котором дейстует эта погода (включительно).
 имя_погодного_региона пока нигде не используется.

